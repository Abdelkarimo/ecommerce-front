<div class="container my-5">
    <!-- Back to Cart Button -->
    <div class="mb-4">
      <button class="btn btn-outline-primary" (click)="backToCart()">
        <i class="fas fa-arrow-left me-2"></i>Back to Cart
      </button>
    </div>
  
    <!-- Page Header -->
    <div class="mb-4">
      <h1 class="display-5 fw-bold section-title">Checkout</h1>
      <p class="text-muted">Complete your purchase securely</p>
    </div>
  
    <div class="row g-4">
      <!-- Left Column - Forms -->
      <div class="col-lg-8">
        
        <!-- Shipping Information Card -->
        <div class="card shadow-sm mb-4">
          <div class="card-body p-4">
            <h4 class="card-title mb-4">
              <i class="fas fa-shipping-fast brand-primary me-2"></i>
              Shipping Information
            </h4>
  
            <div class="row g-3">
              <!-- First Name -->
              <div class="col-md-6">
                <label for="firstName" class="form-label">First Name *</label>
                <input 
                  type="text" 
                  id="firstName" 
                  class="form-control" 
                  [(ngModel)]="firstName"
                  placeholder="Ahmed"
                  required
                >
                <span *ngIf="isFieldInvalid(firstName)" class="text-danger small">First name is required.</span>
              </div>
  
              <!-- Last Name -->
              <div class="col-md-6">
                <label for="lastName" class="form-label">Last Name *</label>
                <input 
                  type="text" 
                  id="lastName" 
                  class="form-control" 
                  [(ngModel)]="lastName"
                  placeholder="Hassan"
                  required
                >
                <span *ngIf="isFieldInvalid(lastName)" class="text-danger small">Last name is required.</span>
              </div>
  
              <!-- Email -->
              <div class="col-md-6">
                <label for="email" class="form-label">Email *</label>
                <input 
                  type="email" 
                  id="email" 
                  class="form-control" 
                  [(ngModel)]="email"
                  placeholder="ahmed@example.com"
                  required
                >
                <span *ngIf="isFieldInvalid(email)" class="text-danger small">Email is required.</span>
              </div>
  
              <!-- Phone -->
              <div class="col-md-6">
                <label for="phone" class="form-label">Phone *</label>
                <input 
                  type="tel" 
                  id="phone" 
                  class="form-control" 
                  [(ngModel)]="phone"
                  placeholder="+20 123 456 7890"
                  required
                >
                <span *ngIf="isFieldInvalid(phone)" class="text-danger small">Phone number is required.</span>
              </div>
  
              <!-- Address -->
              <div class="col-12">
                <label for="address" class="form-label">Street Address *</label>
                <input 
                  type="text" 
                  id="address" 
                  class="form-control" 
                  [(ngModel)]="address"
                  placeholder="123 Tahrir Street"
                  required
                >
                <span *ngIf="isFieldInvalid(address)" class="text-danger small">Street address is required.</span>
              </div>
  
              <!-- City -->
              <div class="col-md-4">
                <label for="city" class="form-label">City *</label>
                <input 
                  type="text" 
                  id="city" 
                  class="form-control" 
                  [(ngModel)]="city"
                  placeholder="Cairo"
                  required
                >
                <span *ngIf="isFieldInvalid(city)" class="text-danger small">City is required.</span>
              </div>
  
              <!-- Country -->
              <div class="col-md-4">
                <label for="country" class="form-label">Country *</label>
                <select 
                  id="country" 
                  class="form-control form-select" 
                  [(ngModel)]="country"
                  required
                >
                  <option value="Egypt">Egypt</option>
                  <option value="UAE">UAE</option>
                  <option value="Saudi Arabia">Saudi Arabia</option>
                  <option value="Jordan">Jordan</option>
                </select>
                <span *ngIf="isFieldInvalid(country)" class="text-danger small">Country is required.</span>
              </div>
  
              <!-- Postal Code -->
              <div class="col-md-4">
                <label for="postalCode" class="form-label">Postal Code</label>
                <input 
                  type="text" 
                  id="postalCode" 
                  class="form-control" 
                  [(ngModel)]="postalCode"
                  placeholder="11511"
                >
              </div>
            </div>
          </div>
        </div>
  
        <!-- Payment Information Card -->
        <div class="card shadow-sm">
          <div class="card-body p-4">
            <h4 class="card-title mb-4">
              <i class="fas fa-credit-card text-primary me-2"></i>
              Payment Information
            </h4>
  
            <!-- Payment Method Selection -->
            <div class="form-group mb-4">
              <label for="payment" class="form-label fw-bold">Payment Method</label>
              <select 
                id="payment" 
                name="payment" 
                class="form-control form-select" 
                [(ngModel)]="selectedPaymentMethod"
                (change)="onPaymentMethodChange(selectedPaymentMethod)"
                required>
                <option value="credit-card">Credit Card</option>
                <option value="paypal">PayPal</option>
                <option value="bank-transfer">Bank Transfer</option>
              </select>
            </div>
  
            <!-- Credit Card Fields -->
            <div *ngIf="selectedPaymentMethod === 'credit-card'" class="payment-section">
              <h5 class="mb-3">
                <i class="fas fa-credit-card text-primary"></i> Credit Card Details
              </h5>
              
              <div class="row g-3">
                <!-- Card Number -->
                <div class="col-12">
                  <label for="cardNumber" class="form-label">Card Number *</label>
                  <input 
                    type="text" 
                    id="cardNumber" 
                    class="form-control" 
                    [(ngModel)]="cardNumber"
                    (input)="formatCardNumber()"
                    placeholder="1234 5678 9012 3456"
                    maxlength="19"
                    required
                  >
                  <small class="text-muted">Test card: 4242 4242 4242 4242</small>
                  <span *ngIf="isCardFieldInvalid(cardNumber)" class="text-danger small">Card number is required.</span>
                </div>
  
                <!-- Cardholder Name -->
                <div class="col-12">
                  <label for="cardName" class="form-label">Cardholder Name *</label>
                  <input 
                    type="text" 
                    id="cardName" 
                    class="form-control" 
                    [(ngModel)]="cardName"
                    placeholder="Ahmed Hassan"
                    required
                  >
                  <span *ngIf="isCardFieldInvalid(cardName)" class="text-danger small">Cardholder name is required.</span>
                </div>
  
                <!-- Expiry Date -->
                <div class="col-md-6">
                  <label for="expiryDate" class="form-label">Expiry Date *</label>
                  <input 
                    type="text" 
                    id="expiryDate" 
                    class="form-control" 
                    [(ngModel)]="expiryDate"
                    (input)="formatExpiryDate()"
                    placeholder="MM/YY"
                    maxlength="5"
                    required
                  >
                  <span *ngIf="isCardFieldInvalid(expiryDate)" class="text-danger small">Expiry date is required.</span>
                </div>
  
                <!-- CVV -->
                <div class="col-md-6">
                  <label for="cvv" class="form-label">CVV *</label>
                  <input 
                    type="text" 
                    id="cvv" 
                    class="form-control" 
                    [(ngModel)]="cvv"
                    placeholder="123"
                    maxlength="3"
                    required
                  >
                  <span *ngIf="isCardFieldInvalid(cvv)" class="text-danger small">CVV is required.</span>
                </div>
              </div>
  
              <div class="alert alert-info mt-3 mb-0">
                <i class="fas fa-lock"></i>
                <small> Your card information is encrypted and secure</small>
              </div>
            </div>
  
            <!-- PayPal Fields -->
            <div *ngIf="selectedPaymentMethod === 'paypal'" class="payment-section">
              <h5 class="mb-3">
                <i class="fab fa-paypal text-primary"></i> PayPal Payment
              </h5>
              
              <div class="form-group mb-3">
                <label for="paypalEmail" class="form-label">PayPal Email *</label>
                <input 
                  type="email" 
                  id="paypalEmail" 
                  class="form-control" 
                  [(ngModel)]="paypalEmail"
                  placeholder="your.email@example.com"
                  required
                >
                  <span *ngIf="isPaypalFieldInvalid(paypalEmail)" class="text-danger small">PayPal email is required.</span>
              </div>
  
              <div class="alert alert-warning mb-0">
                <i class="fas fa-info-circle"></i>
                <small> You will be redirected to PayPal to complete your payment</small>
              </div>
            </div>
  
            <!-- Bank Transfer Fields -->
            <div *ngIf="selectedPaymentMethod === 'bank-transfer'" class="payment-section">
              <h5 class="mb-3">
                <i class="fas fa-university text-primary"></i> Bank Transfer Information
              </h5>
              
              <div class="alert alert-info mb-3">
                <strong>Transfer Details:</strong><br>
                <small>
                  Bank Name: National Bank of Egypt<br>
                  Account Number: 1234567890<br>
                  IBAN: EG123456789012345678901234<br>
                  SWIFT Code: NBEGEGCX<br>
                  Reference: <strong>ORDER-{{ total | number:'1.0-0' }}</strong>
                </small>
              </div>
  
              <div class="row g-3">
                <!-- Transfer Reference -->
                <div class="col-12">
                  <label for="transferReference" class="form-label">Transfer Reference Number *</label>
                  <input 
                    type="text" 
                    id="transferReference" 
                    class="form-control" 
                    [(ngModel)]="transferReference"
                    placeholder="Enter your transfer reference"
                    required
                  >
                  <small class="text-muted">Enter the reference number from your bank transfer</small>
                  <span *ngIf="isBankFieldInvalid(transferReference)" class="text-danger small">Transfer reference is required.</span>
                </div>
  
                <!-- Transfer Date -->
                <div class="col-md-6">
                  <label for="transferDate" class="form-label">Transfer Date *</label>
                  <input 
                    type="date" 
                    id="transferDate" 
                    class="form-control" 
                    [(ngModel)]="transferDate"
                    required
                  >
                  <span *ngIf="isBankFieldInvalid(transferDate)" class="text-danger small">Transfer date is required.</span>
                </div>
  
                <!-- Receipt Upload -->
                <div class="col-md-6">
                  <label for="transferReceipt" class="form-label">Upload Receipt (Optional)</label>
                  <input 
                    type="file" 
                    id="transferReceipt" 
                    class="form-control" 
                    (change)="onFileSelected($event)"
                    accept=".pdf,.jpg,.jpeg,.png"
                  >
                  <small class="text-muted">PDF, JPG, or PNG</small>
                </div>
              </div>
  
              <div class="alert alert-warning mt-3 mb-0">
                <i class="fas fa-clock"></i>
                <small> Your order will be processed after payment verification (1-2 business days)</small>
              </div>
            </div>
  
            <!-- Place Order Button -->
            <div class="mt-4">
                <button 
                  type="button" 
                  class="btn btn-outline-success btn-lg w-100 py-3"
                  (click)="processOrder()">
                <i class="fas fa-lock me-2"></i>
                <span *ngIf="selectedPaymentMethod === 'credit-card'">
                  Complete Payment - USD {{ total | number:'1.2-2' }}
                </span>
                <span *ngIf="selectedPaymentMethod === 'paypal'">
                  Continue with PayPal
                </span>
                <span *ngIf="selectedPaymentMethod === 'bank-transfer'">
                  Submit Transfer Details
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Right Column - Order Summary -->
      <div class="col-lg-4">
        <div class="card shadow-sm sticky-top" style="top: 20px;">
          <div class="card-body p-4">
            <h4 class="card-title mb-4">
              <i class="fas fa-shopping-cart text-primary me-2"></i>
              Order Summary
            </h4>
  
            <!-- Cart Items -->
            <div class="cart-items mb-3" style="max-height: 300px; overflow-y: auto;">
              <div *ngFor="let item of cartItems" class="d-flex gap-3 mb-3 pb-3 border-bottom">
                <img 
                  [src]="item.data.thumbnail || item.data.image" 
                  [alt]="item.data.title"
                  class="rounded"
                  style="width: 60px; height: 60px; object-fit: cover;"
                >
                <div class="flex-grow-1">
                  <h6 class="mb-1 text-truncate" style="max-width: 200px;">
                    {{ item.data.title }}
                  </h6>
                  <small class="text-muted">Qty: {{ item.quantity }}</small>
                  <div class="fw-bold text-primary">
                    USD {{ (item.data.price * (1 - item.data.discountPercentage/100)) | number:'1.2-2' }}
                  </div>
                </div>
              </div>
  
              <!-- Empty cart message -->
              <div *ngIf="cartItems.length === 0" class="text-center text-muted py-3">
                <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                <p>Loading cart items...</p>
              </div>
            </div>
  
            <!-- Price Breakdown -->
            <div class="border-top pt-3">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">Subtotal</span>
                <span class="fw-semibold">USD {{ subtotal | number:'1.2-2' }}</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">Shipping</span>
                <span class="fw-semibold">USD {{ shipping | number:'1.2-2' }}</span>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span class="text-muted">Tax (14%)</span>
                <span class="fw-semibold">USD {{ tax | number:'1.2-2' }}</span>
              </div>
              <div class="d-flex justify-content-between border-top pt-3">
                <span class="h5 mb-0">Total</span>
                <span class="h5 mb-0 text-primary fw-bold">
                  USD {{ total | number:'1.2-2' }}
                </span>
              </div>
            </div>
  
            <!-- Trust Badges -->
            <div class="mt-4 p-3 bg-light rounded">
              <div class="d-flex align-items-center mb-2">
                <i class="fas fa-shield-alt text-success me-2"></i>
                <small class="text-muted">Secure SSL Encryption</small>
              </div>
              <div class="d-flex align-items-center">
                <i class="fas fa-undo text-success me-2"></i>
                <small class="text-muted">30-Day Return Policy</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>